ARG BUILD_FROM
FROM $BUILD_FROM

# FROM alpine:latest
MAINTAINER MickMake <embed@mickmake.com>
USER root

LABEL \
  io.hass.version="VERSION" \
  io.hass.type="addon" \
  io.hass.arch="armhf|aarch64|i386|amd64"


ARG SUNGROW_APPKEY
ENV SUNGROW_APPKEY ${SUNGROW_APPKEY}
ARG SUNGROW_DEBUG
ENV SUNGROW_DEBUG ${SUNGROW_DEBUG}
ARG SUNGROW_HOST
ENV SUNGROW_HOST ${SUNGROW_HOST}
ARG SUNGROW_USER
ENV SUNGROW_USER ${SUNGROW_USER}
ARG SUNGROW_PASSWORD
ENV SUNGROW_PASSWORD ${SUNGROW_PASSWORD}
ARG SUNGROW_TIMEOUT
ENV SUNGROW_TIMEOUT ${SUNGROW_TIMEOUT}

ARG SUNGROW_MQTT_HOST
ENV SUNGROW_MQTT_HOST ${SUNGROW_MQTT_HOST}
ARG SUNGROW_MQTT_PASSWORD
ENV SUNGROW_MQTT_PASSWORD ${SUNGROW_MQTT_PASSWORD}
ARG SUNGROW_MQTT_PORT
ENV SUNGROW_MQTT_PORT ${SUNGROW_MQTT_PORT}
ARG SUNGROW_MQTT_USER
ENV SUNGROW_MQTT_USER ${SUNGROW_MQTT_USER}

ARG TZ
ENV TZ ${TZ}

COPY src/GoSungrow /usr/local/bin/GoSungrow
COPY src/run.sh /usr/local/bin/run.sh
RUN chmod a+x /usr/local/bin/GoSungrow /usr/local/bin/run.sh

# ENTRYPOINT ["/usr/local/bin/GoSungrow"]
# CMD ["crond", "-f", "-l", "2", "-L", "/var/log/cronlogs"]
# CMD ["/usr/local/bin/GoSungrow", "mqtt", "sync"]
CMD ["/usr/local/bin/run.sh"]

